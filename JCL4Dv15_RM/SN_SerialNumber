//%attributes = {"lang":"en"} comment added and reserved by 4D.//SN_SerialNumber//Jiro_num_SerialNumber//Jiro_SN_SerialNumber//zz_SerialNumber//20121213 wat//zz_SequenceNumber//20100909 yasue//シリアル番号を発行C_TEXT($1;$key_word)$key_word:=$1//キーコードC_TEXT($2;$table_name)$table_name:=$2//テーブル名C_LONGINT($0;$counter)$counter:=0//カウンターの値、戻り値C_LONGINT($numofRecs)READ WRITE([Z_SerialNumber])//リードライトモードにする//テーブル名とキー文字列でレコード検索QUERY([Z_SerialNumber];[Z_SerialNumber]SN_KEY_CODE=$key_word;*)QUERY([Z_SerialNumber]; & ;[Z_SerialNumber]SN_TABLE_NAME=$table_name)$numofRecs:=Records in selection([Z_SerialNumber])//レコードがなかったら作成If ($numofRecs<=0)CREATE RECORD([Z_SerialNumber])[Z_SerialNumber]SN_COUNTER:=$counter[Z_SerialNumber]SN_KEY_CODE:=$key_word[Z_SerialNumber]SN_TABLE_NAME:=$table_nameSAVE RECORD([Z_SerialNumber])Else LOAD RECORD([Z_SerialNumber])$counter:=[Z_SerialNumber]SN_COUNTEREnd if //テーブルのロック状態を確認While (Locked([Z_SerialNumber]))//テーブルがロックされていたらディレイDELAY PROCESS(Current process;20)//レコードをロードしてみるUNLOAD RECORD([Z_SerialNumber])LOAD RECORD([Z_SerialNumber])End while //レコードＩDをひとつ増やして保存$counter:=$counter+1[Z_SerialNumber]SN_COUNTER:=$counterSAVE RECORD([Z_SerialNumber])UNLOAD RECORD([Z_SerialNumber])//念のためアンロードしておくREAD ONLY([Z_SerialNumber])//リードオンリーに戻す$0:=$counter//新しいレコードＩD